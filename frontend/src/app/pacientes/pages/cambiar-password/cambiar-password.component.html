<form *ngIf="miFormulario != null" [formGroup]="miFormulario" (ngSubmit)="cambiarPassword()" class="security-form">
    <mat-card class="password-card">
        <div class="security-header">
            <mat-icon class="security-icon">lock_reset</mat-icon>
            <mat-card-title class="security-title">Seguridad de la Cuenta</mat-card-title>
            <p class="security-subtitle">Protege tu acceso al sistema médico</p>
        </div>

        <mat-card-content class="password-content">
            <div class="password-section">
                <mat-form-field appearance="outline" class="security-input">
                    <mat-label>Contraseña actual</mat-label>
                    <input matInput 
                           [type]="mostrarPassword ? 'text' : 'password'" 
                           formControlName="password"
                           required>
                    <mat-icon matSuffix (click)="mostrarPassword = !mostrarPassword" class="toggle-icon">
                        {{mostrarPassword ? 'visibility_off' : 'visibility'}}
                    </mat-icon>
                    <mat-error *ngIf="miFormulario.get('password')?.hasError('required')">
                        Campo obligatorio
                    </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="security-input">
                    <mat-label>Nueva contraseña</mat-label>
                    <input matInput 
                           [type]="mostrarNuevaPassword ? 'text' : 'password'" 
                           formControlName="newPassword"
                           required>
                    <mat-icon matSuffix (click)="mostrarNuevaPassword = !mostrarNuevaPassword" class="toggle-icon">
                        {{mostrarNuevaPassword ? 'visibility_off' : 'visibility'}}
                    </mat-icon>
                    <mat-hint>Mínimo 6 caracteres</mat-hint>
                    <mat-error *ngIf="miFormulario.get('newPassword')?.hasError('minlength')">
                        Mínimo 6 caracteres requeridos
                    </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="security-input">
                    <mat-label>Confirmar nueva contraseña</mat-label>
                    <input matInput 
                           [type]="mostrarConfirmacionPassword ? 'text' : 'password'" 
                           formControlName="newPasswordConfirm"
                           required>
                    <mat-icon matSuffix (click)="mostrarConfirmacionPassword = !mostrarConfirmacionPassword" class="toggle-icon">
                        {{mostrarConfirmacionPassword ? 'visibility_off' : 'visibility'}}
                    </mat-icon>
                    <mat-error *ngIf="miFormulario.hasError('mismatch')">
                        Las contraseñas no coinciden
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="password-requirements">
                <p class="requirements-title">Requisitos de seguridad:</p>
                <ul class="requirements-list">
                    <li><mat-icon>check_circle</mat-icon> Mínimo 6 caracteres</li>
                    <li><mat-icon>check_circle</mat-icon> Sin espacios en blanco</li>
                </ul>
            </div>
        </mat-card-content>

        <mat-card-actions class="security-actions">
            <button mat-raised-button 
                    color="primary" 
                    type="submit"
                    class="security-button"
                    [disabled]="miFormulario.invalid">
                <mat-icon>lock_reset</mat-icon>
                Actualizar Contraseña
            </button>
            
            <button mat-stroked-button 
                    color="warn" 
                    routerLink="/dashboard"
                    class="security-button">
                <mat-icon>cancel</mat-icon>
                Cancelar
            </button>
        </mat-card-actions>
    </mat-card>
</form>